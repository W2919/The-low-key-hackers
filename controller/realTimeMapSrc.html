<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜å¾·åœ°å›¾è·¯å¾„è§„åˆ’ä¸å®šä½</title>
    <script type="text/javascript">
        window._AMapSecurityConfig = {
            securityJsCode: "a645fab3d9396adafc4d4236665981fa",
        };
    </script>
    <script type="text/javascript" src="https://webapi.amap.com/loader.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }
        
        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: linear-gradient(135deg, #1a2a6c, #2a4b8d);
            color: #333;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 15px 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
            padding: 20px;
            gap: 20px;
        }
        
        .sidebar {
            width: 350px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4b6cb7;
        }
        
        .panel h3 {
            margin-bottom: 10px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .panel h3 i {
            color: #4b6cb7;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .input-group input:focus {
            border-color: #4b6cb7;
            outline: none;
            box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.2);
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            background: linear-gradient(135deg, #4b6cb7, #3a5ca9);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        button.secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }
        
        .location-details p, .route-details p {
            margin-bottom: 8px;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
        }
        
        .location-details span, .route-details span {
            font-weight: 600;
            color: #4b6cb7;
        }
        
        .map-container {
            flex: 1;
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .loading {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 200;
            text-align: center;
        }
        
        .loading p {
            margin: 0;
            font-weight: 600;
            color: #4b6cb7;
        }
        
        .spinner {
            border: 4px solid rgba(75, 108, 183, 0.3);
            border-radius: 50%;
            border-top: 4px solid #4b6cb7;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .result-item {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 13px;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        #routePanel {
            min-height: 100px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            background-color: white;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                padding: 10px;
            }
            
            .sidebar {
                width: 100%;
                max-height: 40vh;
            }
            
            .map-container {
                height: 50vh;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸš— é«˜å¾·åœ°å›¾è·¯å¾„è§„åˆ’</h1>
        <p>è¾“å…¥èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œè·å–æœ€ä½³é©¾è½¦è·¯çº¿è§„åˆ’</p>
    </div>
    
    <div class="container">
        <div class="sidebar">
            <div class="panel">
                <h3>ğŸ“ è·¯å¾„è§„åˆ’</h3>
                <div class="input-group">
                    <label for="startPoint">èµ·ç‚¹ï¼š</label>
                    <input type="text" id="startPoint" placeholder="è¯·è¾“å…¥èµ·ç‚¹æˆ–ä½¿ç”¨å½“å‰ä½ç½®">
                </div>
                
                <div class="input-group">
                    <label for="endPoint">ç»ˆç‚¹ï¼š</label>
                    <input type="text" id="endPoint" placeholder="è¯·è¾“å…¥ç»ˆç‚¹åœ°å€" value="å¤©å®‰é—¨">
                </div>
                
                <div class="btn-group">
                    <button id="getLocation">
                        <i>ğŸ“</i> è·å–å½“å‰ä½ç½®
                    </button>
                    <button id="clearRoute" class="secondary">
                        <i>ğŸ—‘ï¸</i> æ¸…é™¤è·¯çº¿
                    </button>
                </div>
                
                <button id="routePlan">
                    <i>ğŸš€</i> å¼€å§‹è·¯å¾„è§„åˆ’
                </button>
            </div>
            
            <div class="panel">
                <h3>ğŸŒ å½“å‰ä½ç½®ä¿¡æ¯</h3>
                <div class="location-details">
                    <p>ç»åº¦: <span id="currentLng">-</span></p>
                    <p>çº¬åº¦: <span id="currentLat">-</span></p>
                    <p>åœ°å€: <span id="currentAddress">æœªè·å–</span></p>
                </div>
            </div>
            
            <div class="panel">
                <h3>ğŸ“Š è·¯å¾„ä¿¡æ¯</h3>
                <div class="route-details">
                    <p>è·ç¦»: <span id="routeDistance">-</span></p>
                    <p>æ—¶é—´: <span id="routeTime">-</span></p>
                    <p>çŠ¶æ€: <span id="routeInstructions">-</span></p>
                </div>
                <div id="routePanel">è·¯çº¿è¯¦æƒ…å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
            </div>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>æ­£åœ¨åŠ è½½åœ°å›¾å’Œè·¯å¾„è§„åˆ’...</p>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–å˜é‡
        let map = null;
        let geolocation = null;
        let driving = null;
        let currentPosition = null;
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }
        
        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        // åˆå§‹åŒ–åœ°å›¾
        function initMap() {
            showLoading();
            
            // ä½¿ç”¨AMapLoaderåŠ è½½åœ°å›¾
            AMapLoader.load({
                key: "4d0632a7126fcd25f89286bc3d33e0e7",
                version: "2.0",
                plugins: ['AMap.Geolocation', 'AMap.Driving', 'AMap.Scale', 'AMap.ToolBar']
            }).then((AMap) => {
                // åˆ›å»ºåœ°å›¾å®ä¾‹
                map = new AMap.Map('map', {
                    zoom: 10,
                    resizeEnable: true,
                    viewMode: '3D',
                    center: [116.397428, 39.90923] // åŒ—äº¬ä¸­å¿ƒç‚¹
                });
                
                // æ·»åŠ åœ°å›¾æ§ä»¶
                map.addControl(new AMap.ToolBar());
                map.addControl(new AMap.Scale());
                
                // åˆå§‹åŒ–å®šä½æ’ä»¶
                geolocation = new AMap.Geolocation({
                    enableHighAccuracy: true,
                    timeout: 10000,
                    buttonOffset: new AMap.Pixel(10, 20),
                    zoomToAccuracy: true,
                    buttonPosition: 'RB'
                });
                
                map.addControl(geolocation);
                
                // ä¿®å¤ï¼šåˆå§‹åŒ–è·¯å¾„è§„åˆ’æ’ä»¶ï¼Œä¸è®¾ç½®panelæˆ–è®¾ç½®ä¸ºå­˜åœ¨çš„å…ƒç´ 
                driving = new AMap.Driving({
                    map: map,
                    policy: AMap.DrivingPolicy.LEAST_TIME,
                    // ä¸è®¾ç½®panelæˆ–è®¾ç½®ä¸ºnullï¼Œé¿å…appendChildé”™è¯¯
                    panel: null
                });
                
                // å°è¯•è·å–å½“å‰ä½ç½®
                getCurrentLocation();
                hideLoading();
                console.log("åœ°å›¾åˆå§‹åŒ–å®Œæˆ");
            }).catch(e => {
                console.error('åœ°å›¾åŠ è½½å¤±è´¥:', e);
                hideLoading();
                alert('åœ°å›¾åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPI Key');
            });
        }
        
        // è·å–å½“å‰ä½ç½®
        function getCurrentLocation() {
            showLoading();
            geolocation.getCurrentPosition(function(status, result) {
                hideLoading();
                
                if (status === 'complete') {
                    currentPosition = {
                        lng: result.position.lng,
                        lat: result.position.lat,
                        address: result.formattedAddress
                    };
                    // æ›´æ–°ç•Œé¢æ˜¾ç¤º
                    document.getElementById('currentLng').textContent = result.position.lng.toFixed(6);
                    document.getElementById('currentLat').textContent = result.position.lat.toFixed(6);
                    document.getElementById('currentAddress').textContent = result.formattedAddress;
                    
                    // å°†å½“å‰ä½ç½®è®¾ç½®ä¸ºèµ·ç‚¹
                    document.getElementById('startPoint').value = result.formattedAddress;
                    
                    // å°†åœ°å›¾ä¸­å¿ƒè®¾ç½®ä¸ºå½“å‰ä½ç½®
                    map.setCenter([result.position.lng, result.position.lat]);
                    
                    // æ·»åŠ å½“å‰ä½ç½®æ ‡è®°
                    new AMap.Marker({
                        position: [result.position.lng, result.position.lat],
                        map: map,
                        title: 'æˆ‘çš„ä½ç½®',
                        content: '<div style="background-color: #4b6cb7; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white;"></div>'
                    });
                    
                    // console.log("å½“å‰ä½ç½®è·å–æˆåŠŸ:", result.formattedAddress);
                } else {
                    console.error('è·å–å½“å‰ä½ç½®å¤±è´¥:', result);
                    alert('è·å–å½“å‰ä½ç½®å¤±è´¥: ' + result.message);
                    document.getElementById('currentAddress').textContent = 'è·å–ä½ç½®å¤±è´¥';
                    
                    // è®¾ç½®é»˜è®¤èµ·ç‚¹
                    document.getElementById('startPoint').value = "åŒ—äº¬å¸‚æœé˜³åŒº";
                }
            });
        }
        
        // è·¯å¾„è§„åˆ’
        function routePlan() {
            const startPoint = document.getElementById('startPoint').value;
            const endPoint = document.getElementById('endPoint').value;
            
            if (!startPoint || !endPoint) {
                alert('è¯·è¾“å…¥èµ·ç‚¹å’Œç»ˆç‚¹');
                return;
            }
            
            showLoading();
            
            // æ¸…é™¤ä¹‹å‰çš„è·¯å¾„
            driving.clear();
            document.getElementById('routePanel').innerHTML = 'è®¡ç®—ä¸­...';
            
            // å®šä¹‰pointså‚æ•°
            const points = [
                {keyword: startPoint},
                {keyword: endPoint}
            ];
            
            console.log("å¼€å§‹è·¯å¾„è§„åˆ’ï¼Œå‚æ•°:", points);
            
            // è¿›è¡Œè·¯å¾„è§„åˆ’
            driving.search(points, function(status, result) {
                console.log("è·¯å¾„è§„åˆ’çŠ¶æ€:", status);
                console.log("è·¯å¾„è§„åˆ’ç»“æœ:", result);
                
                hideLoading();
                
                // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                if (status === 'complete') {
                    document.getElementById('routeInstructions').textContent = 'è·¯å¾„è§„åˆ’æˆåŠŸ';
                    
                    if (result.routes && result.routes.length > 0) {
                        const route = result.routes[0];
                        
                        // æ›´æ–°è·¯å¾„ä¿¡æ¯
                        document.getElementById('routeDistance').textContent = (route.distance / 1000).toFixed(1) + 'å…¬é‡Œ';
                        document.getElementById('routeTime').textContent = Math.ceil(route.time / 60) + 'åˆ†é’Ÿ';
                        
                        // æ˜¾ç¤ºè¯¦ç»†è·¯å¾„
                        let routeHtml = '<div style="font-weight: bold; margin-bottom: 10px;">è·¯çº¿è¯¦æƒ…:</div>';
                        if (route.steps && route.steps.length > 0) {
                            route.steps.forEach((step, index) => {
                                routeHtml += `<div class="result-item">${index+1}. ${step.instruction} (${(step.distance/1000).toFixed(1)}å…¬é‡Œ)</div>`;
                            });
                        } else {
                            routeHtml += '<div class="result-item">æš‚æ— è¯¦ç»†è·¯çº¿ä¿¡æ¯</div>';
                        }
                        document.getElementById('routePanel').innerHTML = routeHtml;
                    } else {
                        document.getElementById('routeInstructions').textContent = 'æœªæ‰¾åˆ°å¯è¡Œè·¯çº¿';
                        document.getElementById('routePanel').innerHTML = 'æœªæ‰¾åˆ°ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„å¯è¡Œè·¯çº¿';
                    }
                } else if (status === 'no_data') {
                    document.getElementById('routeInstructions').textContent = 'æŸ¥è¯¢æ— ç»“æœ';
                    document.getElementById('routePanel').innerHTML = 'æœªæ‰¾åˆ°ç›¸å…³è·¯å¾„ä¿¡æ¯';
                } else {
                    document.getElementById('routeInstructions').textContent = 'æŸ¥è¯¢é”™è¯¯';
                    
                    let errorMsg = "è·¯å¾„è§„åˆ’å¤±è´¥";
                    if (result && result.info) {
                        errorMsg += ": " + result.info;
                    }
                    
                    document.getElementById('routePanel').innerHTML = errorMsg;
                    alert(errorMsg);
                }
            });
        }
        
        // æ¸…é™¤è·¯çº¿
        function clearRoute() {
            if (driving) {
                driving.clear();
            }
            document.getElementById('routeDistance').textContent = '-';
            document.getElementById('routeTime').textContent = '-';
            document.getElementById('routeInstructions').textContent = '-';
            document.getElementById('routePanel').innerHTML = 'è·¯çº¿è¯¦æƒ…å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = function() {
            console.log("é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–åœ°å›¾...");
            initMap();
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('getLocation').addEventListener('click', getCurrentLocation);
            document.getElementById('routePlan').addEventListener('click', routePlan);
            document.getElementById('clearRoute').addEventListener('click', clearRoute);
            
            // æ·»åŠ å›è½¦é”®è§¦å‘è·¯å¾„è§„åˆ’
            document.getElementById('endPoint').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    routePlan();
                }
            });
        };
    </script>
</body>
</html>



