# 混凝土性能预期视频分类系统 - 协作规范与仓库管理指南

## 一、仓库结构说明
本仓库采用模块化隔离设计，各模块代码独立存放，共享资源集中管理。以下是核心目录结构及用途说明：

```
concrete-video-classification/  # 仓库根目录
├── frontend/                   # 前端（VUE）代码
│   ├── src/components/         # 可复用组件（视频上传、结果展示等）
│   ├── src/views/              # 页面视图（首页、分类页、管理页）
│   ├── src/api/                # 后端接口调用封装
│   └── （其他前端标准目录）
│
├── backend/                    # 后端（FastAPI）代码
│   ├── app/api/                # 接口路由定义
│   ├── app/core/               # 核心配置（数据库、日志等）
│   ├── app/crud/               # 数据库操作逻辑
│   └── （其他后端标准目录）
│
├── algorithm/                  # 算法（PyTorch）代码
│   ├── data/                   # 视频预处理脚本
│   ├── models/                 # 模型定义与加载
│   ├── inference/              # 推理功能实现
│   └── （其他算法相关目录）
│
├── docs/                       # 项目文档（会议纪要、接口文档等）
├── data_samples/               # 示例数据（小体积视频、标签样例）
├── .gitignore                  # 忽略文件配置
├── README.md                   # 仓库总说明
└── docker-compose.yml          # （后期）部署配置
```

**各模块负责人职责**：
- 前端：维护`frontend/`目录，确保组件复用性和页面兼容性
- 后端：维护`backend/`目录，保证接口稳定性和数据安全性
- 算法：维护`algorithm/`目录，优化模型性能和推理效率
- 全员：共同维护`docs/`目录，及时更新相关文档


## 二、分支管理规范
### 1. 核心分支（长期存在）
- `main`：主分支，存放可部署的稳定版本  
  ✅ 仅通过PR从`develop`分支合并  
  ❌ 禁止直接提交代码或从功能分支直接合并

- `develop`：开发分支，集成各模块的稳定代码  
  ✅ 仅通过PR从功能分支（`feat/xxx`）合并  
  ❌ 禁止直接提交代码


### 2. 临时分支（功能完成后删除）
| 分支类型 | 命名格式 | 来源分支 | 用途 |
|----------|----------|----------|------|
| 功能开发 | `feat/模块-功能名` | `develop` | 开发新功能（如`feat/frontend-upload`） |
| Bug修复 | `fix/模块-问题描述` | `develop` | 修复开发中的bug（如`fix/backend-timeout`） |
| 紧急修复 | `hotfix/问题描述` | `main` | 修复线上紧急问题（修复后同步到`main`和`develop`） |


### 3. 分支操作流程
```bash
# 1. 从develop拉取最新代码并创建功能分支
git checkout develop
git pull origin develop
git checkout -b feat/xxx

# 2. 开发过程中定期同步develop最新代码（避免冲突）
git fetch origin develop
git merge origin develop  # 解决冲突后提交

# 3. 功能完成后推送到远程
git push origin feat/xxx

# 4. 在GitHub发起PR（目标分支：develop），等待审核合并
# 5. 合并后删除本地和远程功能分支
git checkout develop
git pull origin develop
git branch -d feat/xxx
git push origin --delete feat/xxx
```


## 三、代码提交规范
采用**Conventional Commits**规范，提交信息需清晰反映变更内容，格式为：  
`类型(可选作用域): 描述信息`


### 1. 提交类型（常用）
| 类型 | 说明 | 示例 |
|------|------|------|
| `feat` | 新功能开发 | `feat(frontend): 新增视频批量上传组件` |
| `fix` | 修复bug | `fix(algorithm): 解决帧提取时的黑边问题` |
| `docs` | 文档更新 | `docs(backend): 补充分类接口参数说明` |
| `style` | 代码格式调整（不影响功能） | `style: 统一变量命名规范` |
| `refactor` | 代码重构（不新增功能/修复bug） | `refactor(backend): 拆分文件处理逻辑` |
| `test` | 测试代码相关 | `test(algorithm): 添加模型准确率测试用例` |
| `chore` | 构建/依赖调整 | `chore: 升级PyTorch版本至1.13.0` |


### 2. 提交要求
- 描述信息简洁明了（≤50字），使用中文或英文（建议统一用中文）
- 每次提交只包含一个逻辑变更（避免一次提交多个不相关功能）
- 提交前需本地测试通过（前端页面无报错、后端接口可调用、算法脚本可运行）


## 四、协作流程规范
### 1. 开发前准备
- 确认当前任务属于哪个模块，明确需求细节（参考`docs/`中的需求文档）
- 从`develop`分支创建对应功能分支（命名符合规范）
- 配置本地开发环境（参考各模块`README.md`的环境要求）


### 2. 开发过程中
- 频繁提交代码（建议每完成一个小功能点提交一次）
- 每日下班前同步`develop`分支最新代码，及时解决冲突
- 遇到阻塞问题（如接口依赖、数据缺失），1小时内同步至团队群


### 3. 功能完成后
- 本地自测通过（检查是否符合需求、是否有新增bug）
- 推送功能分支到远程，在GitHub发起PR，填写以下信息：
  - 变更内容（实现了什么功能/修复了什么问题）
  - 测试方式（如何验证功能正确性）
  - 关联的任务ID（如有）
- 指定至少1名审核人（前端功能→前端负责人，后端功能→后端负责人，跨模块功能→双方负责人）


### 4. PR审核规范
- 审核人需在12小时内完成审核，重点检查：
  - 代码是否符合项目规范（命名、格式等）
  - 功能是否满足需求（可运行测试验证）
  - 是否存在性能问题或潜在bug
- 审核通过后由审核人合并PR；不通过则注明修改意见，由开发者修改后重新提交


## 五、注意事项
### 1. .gitignore配置
- 前端忽略：`node_modules/`、`.env.local`（本地环境变量）、`dist/`
- 后端/算法忽略：`venv/`（虚拟环境）、`.env`（敏感配置）、`*.pth`（模型权重）
- 全局忽略：IDE配置文件（.idea/、.vscode/）、系统临时文件（.DS_Store等）


### 2. 敏感信息处理
- 数据库密码、API密钥等敏感信息**禁止提交到仓库**
- 通过环境变量存储，提交`.env.example`作为模板（仅含变量名，不含值）


### 3. 大文件管理
- 视频数据集、模型权重（>100MB）禁止直接提交
- 示例数据放`data_samples/`，完整数据通过团队云盘共享
- 模型权重建议存储在Hugging Face Model Hub或阿里云OSS，代码中通过链接下载


### 4. 文档更新
- 功能/接口变更后，需同步更新`docs/`中对应文档（如接口字段修改→更新接口文档）
- 会议纪要需在会议结束后24小时内上传至`docs/meeting_notes/`


## 六、FAQ
1. **Q：忘记按规范提交了怎么办？**  
   A：提交后未推送可使用`git commit --amend`修改；已推送可提交一个修正commit（如`docs: 修正前次提交信息格式`）。

2. **Q：合并时遇到冲突怎么处理？**  
   A：本地拉取目标分支最新代码，手动解决冲突后标记为已解决（`git add .`），再提交合并结果。

3. **Q：模型权重太大，如何让代码正常加载？**  
   A：在`algorithm/models/README.md`中说明权重下载链接和存放路径，代码中判断权重是否存在，不存在则提示下载。


---

请所有成员严格遵守以上规范，确保协作高效有序。如有疑问或建议，可在团队会议中提出讨论更新。

最后更新时间：2025-11-07
